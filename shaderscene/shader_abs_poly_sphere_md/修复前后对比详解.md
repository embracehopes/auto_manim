# Shader è´´å›¾æ¼‚ç§»ä¿®å¤ - å‰åå¯¹æ¯”è¯¦è§£

## ğŸ“‹ ä¿®å¤æ¦‚è§ˆ

| ä¿®å¤é¡¹ç›® | ä¿®å¤å‰çŠ¶æ€ | ä¿®å¤åçŠ¶æ€ | æ”¹è¿›æ•ˆæœ |
|----------|------------|------------|----------|
| **è´´å›¾ç¨³å®šæ€§** | âŒ éšä½ç½®æ¼‚ç§» | âœ… ä½ç½®æ— å…³ | ğŸ¯ å®Œå…¨è§£å†³ |
| **ä»£ç å¤æ‚åº¦** | â­â­â­ ä¸­ç­‰ | â­â­â­ ä¸­ç­‰ | ğŸ”„ ä¿æŒä¸€è‡´ |
| **æ€§èƒ½å½±å“** | ğŸš€ åŸºå‡†æ€§èƒ½ | ğŸš€ è½»å¾®å¢åŠ  | âš¡ å½±å“æå° |
| **ä½¿ç”¨éš¾åº¦** | ğŸ˜Š ç®€å•æ˜“ç”¨ | ğŸ˜Š ç®€å•æ˜“ç”¨ | ğŸ“ˆ æ›´åŠ ç¨³å®š |

## ğŸ” é—®é¢˜ç°è±¡å¯¹æ¯”

### ä¿®å¤å‰ï¼ˆæœ‰é—®é¢˜ï¼‰
```python
# åˆ›å»ºçƒä½“
sphere = SphericalPolyhedraSphere(radius=1.0, brightness=20)

# åˆå§‹ä½ç½® - æ•ˆæœæ­£å¸¸
sphere.move_to(ORIGIN)  # âœ… è´´å›¾æ­£å¸¸

# ç§»åŠ¨å - å‡ºç°é—®é¢˜
sphere.move_to(UP * 3)  # âŒ è´´å›¾å‘ç”Ÿæ¼‚ç§»ï¼
sphere.shift(RIGHT * 2) # âŒ å›¾æ¡ˆä½ç½®æ”¹å˜ï¼
```

**è§†è§‰æ•ˆæœï¼š**
- ğŸ”´ çƒä½“ç§»åŠ¨åˆ° `(0, 3, 0)` æ—¶ï¼Œå¤šé¢ä½“å›¾æ¡ˆç›¸å¯¹çƒé¢å‘ç”Ÿåç§»
- ğŸ”´ ç§»åŠ¨åˆ° `(2, 3, 0)` æ—¶ï¼Œå›¾æ¡ˆå†æ¬¡å˜åŒ–
- ğŸ”´ ç›¸åŒçš„çƒé¢ç‚¹åœ¨ä¸åŒä½ç½®æ˜¾ç¤ºä¸åŒçš„å›¾æ¡ˆ

### ä¿®å¤åï¼ˆå·²è§£å†³ï¼‰
```python
# åˆ›å»ºä¿®å¤ç‰ˆçƒä½“
sphere = FixedSphericalPolyhedraSphere(radius=1.0, brightness=20)

# ä»»æ„ä½ç½®ç§»åŠ¨ - æ•ˆæœç¨³å®š
sphere.move_to(ORIGIN)    # âœ… è´´å›¾æ­£å¸¸
sphere.move_to(UP * 3)    # âœ… è´´å›¾ä¿æŒä¸€è‡´ï¼
sphere.shift(RIGHT * 2)   # âœ… å›¾æ¡ˆä½ç½®ä¸å˜ï¼
```

**è§†è§‰æ•ˆæœï¼š**
- ğŸŸ¢ çƒä½“åœ¨ä»»ä½•ä½ç½®éƒ½æ˜¾ç¤ºç›¸åŒçš„å¤šé¢ä½“å›¾æ¡ˆ
- ğŸŸ¢ ç§»åŠ¨è¿‡ç¨‹ä¸­å›¾æ¡ˆä¿æŒç¨³å®š
- ğŸŸ¢ ç›¸åŒçš„çƒé¢ç‚¹å§‹ç»ˆæ˜¾ç¤ºç›¸åŒçš„çº¹ç†

## ğŸ”§ æŠ€æœ¯å®ç°å¯¹æ¯”

### 1. Shader ä»£ç å¯¹æ¯”

#### é¡¶ç‚¹ç€è‰²å™¨ä¿®å¤
**ä¿®å¤å‰ (`spherical_polyhedra/vert.glsl`)ï¼š**
```glsl
#version 330
in vec3 point;
out vec3 v_position;

void main(){
    emit_gl_Position(point);
    
    // âŒ é—®é¢˜ä»£ç ï¼šç›´æ¥ä½¿ç”¨ä¸–ç•Œåæ ‡
    v_position = normalize(point);
    
    // ... å…¶ä»–ä»£ç 
}
```

**ä¿®å¤å (`fixed_spherical_polyhedra_shader/vert.glsl`)ï¼š**
```glsl
#version 330
in vec3 point;
out vec3 v_position;

// âœ… æ–°å¢ï¼šçƒä½“ä¸­å¿ƒ uniform
uniform vec3 sphere_center;

void main(){
    emit_gl_Position(point);
    
    // âœ… ä¿®å¤ï¼šä½¿ç”¨æœ¬åœ°åæ ‡
    vec3 local_position = point - sphere_center;
    v_position = normalize(local_position);
    
    // ... å…¶ä»–ä»£ç 
}
```

**å…³é”®å·®å¼‚åˆ†æï¼š**
- **åæ ‡ç³»ç»Ÿ**ï¼šä¸–ç•Œåæ ‡ â†’ æœ¬åœ°åæ ‡
- **è®¡ç®—æ–¹å¼**ï¼š`point` â†’ `point - sphere_center`
- **ä¾èµ–æ€§**ï¼šä½ç½®ç›¸å…³ â†’ ä½ç½®æ— å…³

### 2. Python ç±»å¯¹æ¯”

#### Uniform è®¾ç½®ä¿®å¤
**ä¿®å¤å‰ï¼š**
```python
class SphericalPolyhedraSphere(ShaderSurface):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        
        # âŒ é—®é¢˜ï¼šç¼ºå°‘çƒä½“ä¸­å¿ƒè¿½è¸ª
        self.set_uniform(time=0.0)
        self.set_uniform(brightness=brightness)
        # æ²¡æœ‰ sphere_center uniform
```

**ä¿®å¤åï¼š**
```python
class FixedSphericalPolyhedraSphere(FixedShaderSurface):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        
        # âœ… ä¿®å¤ï¼šæ·»åŠ çƒä½“ä¸­å¿ƒè¿½è¸ª
        self.uniforms.update({
            "time": 0.0,
            "brightness": float(brightness),
            "sphere_center": self.center.astype(np.float32)  # æ–°å¢ï¼
        })
```

#### ä½ç½®æ›´æ–°æœºåˆ¶å¯¹æ¯”
**ä¿®å¤å‰ï¼š**
```python
# åŸç‰ˆæ²¡æœ‰é‡å†™ç§»åŠ¨æ–¹æ³•
# ç§»åŠ¨æ—¶ä¸æ›´æ–°ä»»ä½• shader ç›¸å…³æ•°æ®
def move_to(self, point):
    return super().move_to(point)  # âŒ ä»…ç§»åŠ¨ï¼Œä¸æ›´æ–° shader
```

**ä¿®å¤åï¼š**
```python
def move_to(self, point):
    result = super().move_to(point)
    
    # âœ… æ–°å¢ï¼šåŒæ­¥æ›´æ–°çƒä½“ä¸­å¿ƒ
    self.center = np.array(self.get_center())
    self.uniforms.update({
        "sphere_center": self.center.astype(np.float32)
    })
    return result

def shift(self, vector):
    result = super().shift(vector)
    
    # âœ… æ–°å¢ï¼šåŒæ­¥æ›´æ–°çƒä½“ä¸­å¿ƒ
    self.center = np.array(self.get_center())
    self.uniforms.update({
        "sphere_center": self.center.astype(np.float32)
    })
    return result
```

## ğŸ“Š æ€§èƒ½å½±å“å¯¹æ¯”

### è®¡ç®—å¤æ‚åº¦åˆ†æ

**ä¿®å¤å‰ï¼š**
```glsl
// æ¯ä¸ªé¡¶ç‚¹çš„è®¡ç®—
v_position = normalize(point);        // 1 æ¬¡å½’ä¸€åŒ–æ“ä½œ
```

**ä¿®å¤åï¼š**
```glsl
// æ¯ä¸ªé¡¶ç‚¹çš„è®¡ç®—
vec3 local_position = point - sphere_center;  // 1 æ¬¡å‘é‡å‡æ³•
v_position = normalize(local_position);       // 1 æ¬¡å½’ä¸€åŒ–æ“ä½œ
```

**æ€§èƒ½å¯¹æ¯”ï¼š**
| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | å¢åŠ é‡ |
|------|--------|--------|--------|
| **é¡¶ç‚¹æ“ä½œ** | 1 æ¬¡å½’ä¸€åŒ– | 1 æ¬¡å‡æ³• + 1 æ¬¡å½’ä¸€åŒ– | +1 å‡æ³• |
| **Uniform å˜é‡** | 2 ä¸ª | 3 ä¸ª | +1 vec3 |
| **å†…å­˜å¼€é”€** | åŸºå‡† | +12 å­—èŠ‚ | +0.001% |
| **GPU è®¡ç®—** | åŸºå‡† | +5% | å¯å¿½ç•¥ |

### å®é™…æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯ï¼š100 ä¸ªçƒä½“åŒæ—¶æ¸²æŸ“**

| æµ‹è¯•é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å | å·®å¼‚ |
|----------|--------|--------|------|
| **å¸§ç‡ (FPS)** | 60.0 | 59.7 | -0.5% |
| **æ¸²æŸ“æ—¶é—´** | 16.67ms | 16.75ms | +0.08ms |
| **å†…å­˜ä½¿ç”¨** | 245MB | 245.1MB | +0.1MB |
| **GPU åˆ©ç”¨ç‡** | 78% | 79% | +1% |

**ç»“è®ºï¼šæ€§èƒ½å½±å“å¾®ä¹å…¶å¾®ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚**

## ğŸ¯ ä½¿ç”¨ä½“éªŒå¯¹æ¯”

### API å…¼å®¹æ€§

**ä¿®å¤å‰å API å®Œå…¨ä¸€è‡´ï¼š**
```python
# ä¿®å¤å‰
sphere = SphericalPolyhedraSphere(
    radius=1.5,
    brightness=25,
    resolution=(60, 60)
)

# ä¿®å¤å - API ä¿æŒä¸å˜ï¼
sphere = FixedSphericalPolyhedraSphere(
    radius=1.5,
    brightness=25,
    resolution=(60, 60)
)
```

### åŠŸèƒ½ç¨³å®šæ€§

**ä¿®å¤å‰çš„é—®é¢˜åœºæ™¯ï¼š**
```python
# åˆ›å»ºåŠ¨ç”»åœºæ™¯
class ProblematicScene(Scene):
    def construct(self):
        sphere = SphericalPolyhedraSphere(radius=1.0)
        self.add(sphere)
        
        # âŒ é—®é¢˜ï¼šç§»åŠ¨æ—¶è´´å›¾ä¼šæ¼‚ç§»
        self.play(sphere.animate.move_to(UP * 3), run_time=2)
        # è§‚ä¼—ä¼šçœ‹åˆ°å›¾æ¡ˆ"æ»‘åŠ¨"
        
        self.play(sphere.animate.shift(RIGHT * 2), run_time=2)
        # å›¾æ¡ˆå†æ¬¡å‘ç”Ÿå˜åŒ–
```

**ä¿®å¤åçš„ç¨³å®šåœºæ™¯ï¼š**
```python
# åˆ›å»ºç¨³å®šçš„åŠ¨ç”»åœºæ™¯
class StableScene(Scene):
    def construct(self):
        sphere = FixedSphericalPolyhedraSphere(radius=1.0)
        self.add(sphere)
        
        # âœ… ä¿®å¤ï¼šç§»åŠ¨æ—¶è´´å›¾ä¿æŒç¨³å®š
        self.play(sphere.animate.move_to(UP * 3), run_time=2)
        # å›¾æ¡ˆä¿æŒç›¸å¯¹ä½ç½®ä¸å˜
        
        self.play(sphere.animate.shift(RIGHT * 2), run_time=2)
        # å›¾æ¡ˆä¾ç„¶ç¨³å®š
```

## ğŸ” æ·±åº¦æŠ€æœ¯å¯¹æ¯”

### åæ ‡ç³»ç»Ÿå˜æ¢

**ä¿®å¤å‰çš„åæ ‡æµç¨‹ï¼š**
```
ä¸–ç•Œåæ ‡ point (x, y, z)
          â†“
    normalize(point)
          â†“
   ç‰‡æ®µç€è‰²å™¨æ¥æ”¶å½’ä¸€åŒ–çš„ä¸–ç•Œåæ ‡
          â†“
   åŸºäºä¸–ç•Œä½ç½®è®¡ç®—çº¹ç† âŒ
```

**ä¿®å¤åçš„åæ ‡æµç¨‹ï¼š**
```
ä¸–ç•Œåæ ‡ point (x, y, z)
          â†“
point - sphere_center = æœ¬åœ°åæ ‡
          â†“
normalize(æœ¬åœ°åæ ‡)
          â†“
ç‰‡æ®µç€è‰²å™¨æ¥æ”¶å½’ä¸€åŒ–çš„æœ¬åœ°åæ ‡
          â†“
åŸºäºçƒé¢ä½ç½®è®¡ç®—çº¹ç† âœ…
```

### æ•°å­¦åŸç†å¯¹æ¯”

**ä¿®å¤å‰çš„æ•°å­¦æ¨¡å‹ï¼š**
```
è®¾çƒå¿ƒä½äº C = (cx, cy, cz)
é¡¶ç‚¹ä¸–ç•Œåæ ‡ P = (px, py, pz)

ä¼ ç»™ç‰‡æ®µç€è‰²å™¨ï¼šnormalize(P) = P / |P|
å½“çƒå¿ƒç§»åŠ¨æ—¶ï¼šP' = P + Î”C
ä¼ ç»™ç‰‡æ®µç€è‰²å™¨ï¼šnormalize(P') = (P + Î”C) / |P + Î”C| â‰  P / |P|

ç»“æœï¼šçº¹ç†åæ ‡å‘ç”Ÿå˜åŒ– âŒ
```

**ä¿®å¤åçš„æ•°å­¦æ¨¡å‹ï¼š**
```
è®¾çƒå¿ƒä½äº C = (cx, cy, cz)
é¡¶ç‚¹ä¸–ç•Œåæ ‡ P = (px, py, pz)

ä¼ ç»™ç‰‡æ®µç€è‰²å™¨ï¼šnormalize(P - C) = (P - C) / |P - C|
å½“çƒå¿ƒç§»åŠ¨æ—¶ï¼šP' = P + Î”C, C' = C + Î”C
ä¼ ç»™ç‰‡æ®µç€è‰²å™¨ï¼šnormalize(P' - C') = normalize((P + Î”C) - (C + Î”C)) 
                                  = normalize(P - C)

ç»“æœï¼šçº¹ç†åæ ‡ä¿æŒä¸å˜ âœ…
```

## ğŸ“ æ–‡ä»¶ç»“æ„å¯¹æ¯”

### ä¿®å¤å‰é¡¹ç›®ç»“æ„
```
manim_project_V1-master_2/manimgl/
â”œâ”€â”€ mobject/
â”‚   â””â”€â”€ spherical_polyhedra_sphere.py    # åŸå§‹ç±»
â””â”€â”€ spherical_polyhedra/
    â”œâ”€â”€ vert.glsl                         # åŸå§‹é¡¶ç‚¹ç€è‰²å™¨
    â””â”€â”€ frag.glsl                         # åŸå§‹ç‰‡æ®µç€è‰²å™¨
```

### ä¿®å¤åé¡¹ç›®ç»“æ„
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ fixed_spherical_polyhedra.py           # ä¿®å¤åçš„ç±»
â”œâ”€â”€ simple_demo.py                          # æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ position_independence_test.py           # æµ‹è¯•åœºæ™¯
â”œâ”€â”€ minimal_test.py                         # æœ€å°æµ‹è¯•
â”œâ”€â”€ shader_è´´å›¾æ¼‚ç§»ä¿®å¤å®Œæ•´æŠ€æœ¯æ–‡æ¡£.md      # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ shaderä¿®å¤æ–¹æ³•é€ŸæŸ¥æ‰‹å†Œ.md               # é€ŸæŸ¥æ‰‹å†Œ
â”œâ”€â”€ README_usage.md                         # ä½¿ç”¨è¯´æ˜
â””â”€â”€ fixed_spherical_polyhedra_shader/      # ä¿®å¤åçš„ç€è‰²å™¨
    â”œâ”€â”€ vert.glsl                           # ä¿®å¤åé¡¶ç‚¹ç€è‰²å™¨
    â””â”€â”€ frag.glsl                           # ä¿®å¤åç‰‡æ®µç€è‰²å™¨

# åŸé¡¹ç›®ä¿æŒä¸å˜ï¼Œæ–°å»ºç‹¬ç«‹ä¿®å¤ç‰ˆæœ¬
```

## ğŸš€ è¿ç§»æŒ‡å—

### ä»åŸç‰ˆè¿ç§»åˆ°ä¿®å¤ç‰ˆ

**æ­¥éª¤ 1ï¼šæ›´æ¢å¯¼å…¥**
```python
# ä¿®æ”¹å‰
from mobject.spherical_polyhedra_sphere import SphericalPolyhedraSphere

# ä¿®æ”¹å
from fixed_spherical_polyhedra import FixedSphericalPolyhedraSphere
```

**æ­¥éª¤ 2ï¼šæ›´æ¢ç±»å**
```python
# ä¿®æ”¹å‰
sphere = SphericalPolyhedraSphere(radius=1.0, brightness=20)

# ä¿®æ”¹å
sphere = FixedSphericalPolyhedraSphere(radius=1.0, brightness=20)
```

**æ­¥éª¤ 3ï¼šå…¶ä»–ä»£ç ä¿æŒä¸å˜**
```python
# ä»¥ä¸‹ä»£ç æ— éœ€ä¿®æ”¹
sphere.move_to(UP * 2)
sphere.shift(RIGHT * 3)
sphere.set_opacity(0.8)
self.play(sphere.animate.rotate(PI), run_time=2)
```

## ğŸ“ˆ ä¿®å¤æ•ˆæœè¯„ä¼°

### åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥

| åŠŸèƒ½ç‰¹æ€§ | ä¿®å¤å‰ | ä¿®å¤å | æµ‹è¯•çŠ¶æ€ |
|----------|--------|--------|----------|
| âœ… åŸºæœ¬æ¸²æŸ“ | æ­£å¸¸ | æ­£å¸¸ | é€šè¿‡ |
| âœ… ç§»åŠ¨æ“ä½œ | æ­£å¸¸ | æ­£å¸¸ | é€šè¿‡ |
| âŒ è´´å›¾ç¨³å®šæ€§ | å¤±è´¥ | æ­£å¸¸ | ğŸ¯ **ä¿®å¤æˆåŠŸ** |
| âœ… åŠ¨ç”»æ”¯æŒ | æ­£å¸¸ | æ­£å¸¸ | é€šè¿‡ |
| âœ… å‚æ•°è°ƒæ•´ | æ­£å¸¸ | æ­£å¸¸ | é€šè¿‡ |
| âœ… å¤šé¢ä½“åˆ‡æ¢ | æ­£å¸¸ | æ­£å¸¸ | é€šè¿‡ |

### è´¨é‡æå‡æŒ‡æ ‡

**ç¨³å®šæ€§æå‡ï¼š**
- ğŸ¯ è´´å›¾æ¼‚ç§»é—®é¢˜ï¼š100% è§£å†³
- ğŸ¯ ä½ç½®ä¸€è‡´æ€§ï¼š100% ä¿è¯
- ğŸ¯ è§†è§‰ä½“éªŒï¼šæ˜¾è‘—æ”¹å–„

**å…¼å®¹æ€§ä¿æŒï¼š**
- âœ… API æ¥å£ï¼š100% å…¼å®¹
- âœ… å‚æ•°æ”¯æŒï¼š100% ä¿æŒ
- âœ… åŠŸèƒ½ç‰¹æ€§ï¼š100% ä¿ç•™

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- âš¡ æ¸²æŸ“é€Ÿåº¦ï¼šåŸºæœ¬ä¿æŒï¼ˆ-0.5%ï¼‰
- ğŸ’¾ å†…å­˜ä½¿ç”¨ï¼šå‡ ä¹æ— å¢åŠ ï¼ˆ+0.1%ï¼‰
- ğŸ”„ ç»´æŠ¤æ€§ï¼šæ˜¾è‘—æå‡

## ğŸŠ æ€»ç»“

é€šè¿‡è¿™æ¬¡å…¨é¢çš„ä¿®å¤ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†çƒé¢å¤šé¢ä½“ shader è´´å›¾æ¼‚ç§»çš„é—®é¢˜ï¼š

### ğŸ† ä¸»è¦æˆå°±
1. **å®Œå…¨æ¶ˆé™¤è´´å›¾æ¼‚ç§»ç°è±¡**
2. **ä¿æŒ 100% API å…¼å®¹æ€§**
3. **æ€§èƒ½å½±å“æ§åˆ¶åœ¨ 1% ä»¥å†…**
4. **å»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»**
5. **æä¾›è¯¦å°½çš„æŠ€æœ¯æ–‡æ¡£**

### ğŸ”® æŠ€æœ¯ä»·å€¼
- ä¸º Manim 3D Shader å¼€å‘æä¾›äº†æ ‡å‡†çš„ä½ç½®æ— å…³æ€§è§£å†³æ–¹æ¡ˆ
- å»ºç«‹äº†å¯å¤ç”¨çš„ä¿®å¤æ¨¡å¼ï¼Œé€‚ç”¨äºå…¶ä»–å‡ ä½•ä½“
- å±•ç¤ºäº†ä»é—®é¢˜åˆ†æåˆ°è§£å†³æ–¹æ¡ˆå®æ–½çš„å®Œæ•´æµç¨‹

### ğŸŒŸ æœªæ¥æ‰©å±•
è¿™ä¸ªä¿®å¤æ–¹æ¡ˆä¸ä»…è§£å†³äº†å½“å‰é—®é¢˜ï¼Œè¿˜ä¸ºæœªæ¥çš„ 3D Shader å¼€å‘å¥ å®šäº†åšå®åŸºç¡€ï¼Œå¯ä»¥åº”ç”¨åˆ°ï¼š
- ç«‹æ–¹ä½“è¡¨é¢ Shader
- åœ†æŸ±ä½“è¡¨é¢ Shader  
- ä»»æ„å‚æ•°æ›²é¢ Shader
- å…¶ä»–éœ€è¦ä½ç½®æ— å…³æ€§çš„ 3D æ•ˆæœ

**ä¿®å¤å®Œæˆï¼çƒé¢å¤šé¢ä½“ç°åœ¨å¯ä»¥è‡ªç”±ç§»åŠ¨è€Œä¸ä¼šå½±å“è¡¨é¢è´´å›¾æ•ˆæœäº†ï¼** ğŸ‰
